# Modeling Molecular Cloud Temperatures and Star Formation

## Overview

This repository contains the code and resources for my research project focused on modeling molecular cloud temperatures, molecular line emissivities (i.e. HCN, CO and also HCO+), and star formation rates. This work is built upon the foundational code from my published work: Bemis et al., A&A, 692, A146 (2024). The primary objective of this project is to understand the physical conditions that govern star formation in diverse galactic environments, with a particular emphasis on gas temperature profiles, variations in emissivity, and their influence on observational estimates of (dense) gas star formation efficiency.

## Problem Statement

Directly measuring kinetic temperatures in dense molecular gas is a significant challenge in astrophysics due to the optical depth of these regions to thermal continuum emission. This project addresses this by developing a computational framework to infer these temperatures. It uses radiative transfer modeling (integrating RADEX) to generate synthetic spectral line intensities of key molecular species (e.g., CO, HCN, HCO+). The derived temperatures are crucial for accurately characterizing the physical conditions (e.g., density, pressure) within molecular clouds, which in turn provides vital insights into the mechanisms and efficiency of star formation.

## Data Sources

This project utilizes and generates several types of data:

* **`model_subset300.csv`**: This file serves as the primary input data, containing a subset of 300 randomly sampled cloud properties derived from observational studies of nearby galaxies. These properties were constructed from:

    * Sun, J., Leroy, A. K., Ostriker, E. C., et al. 2020, ApJ, 892, 148 (PHANGS galaxies)

    * Brunetti, N., Wilson, C. D., He, H., et al. 2024, MNRAS, 530, 597 (the Antennae galaxies: NGC4038/9)

    * Brunetti, N., Wilson, C. D., Sliwa, K., et al. 2021, MNRAS, 500, 4730 (NGC3256)

* **`model_grid.tsv`**: This file is an *output* generated by the `input_measurements_grid.py` script, summarizing calculated model properties. It is not an input to the repository and will be ignored by Git.

* **`grid_COcooling_new.out`**: This is a necessary external input file that is included directly in this repository. It was generated following the prescription by Sharda, P., & Krumholz, M. R. 2022, MNRAS, 509, 1959.

## Methodology

This project employs a multi-faceted computational approach to model molecular clouds and infer their properties:

* **Temperature Estimation**: The core of the model involves estimating gas temperatures by balancing various heating and cooling mechanisms (e.g., cosmic ray heating, dust-gas cooling, H2 formation heating). The temperature estimation code is based on the methodology described in Sharda & Krumholz 2022, MNRAS, 509, 1959. This is primarily handled by `check_temp.py` and `temp_estimate.py`.

* **Density Probability Distribution Functions (PDFs)**: The project constructs PDFs based on turbulence and gravitational collapse theories to describe the density structure of the clouds. This allows for a statistical representation of the gas distribution. More information on the density profiles and PDFs used can be found in Bemis & Wilson 2023 ApJ 945 42. Functions for this are implemented in `PDF_model_functions.py`.

* **Radiative Transfer Modeling**: This code employs RADEX (Radiative Transfer Code for Molecular Lines), integrated via `radex_functions.py`, to simulate molecular line emission from the modeled clouds. This provides crucial insights into their observable properties, such as line fluxes, excitation temperatures, and optical depths for species like CO, HCN, and HCO+.

* **Star Formation Rate (SFR) Calculation**: By integrating the derived PDFs with star formation efficiencies, the project estimates Star Formation Rates (SFRs) and depletion times based on analytical star formation theories (Burkhart, B. 2018, ApJ, 863, 118 and Burkhart, B., & Mocz, P. 2019, ApJ, 879, 129) for the modeled clouds. Functions for these calculations are found in `emissivity_model_functions.py`.

* **Workflow Orchestration**:

    * `input_measurements_grid.py`: This script reads in cloud properties, estimates gas temperature profiles, and saves detailed model outputs and plots.

    * `run_model_grid.py`: This script processes the output from `input_measurements_grid.py` to perform radiative transfer calculations and derive molecular line properties and star formation characteristics. It runs sequentially in this repository version.

    * `constants.py`: Defines physical and numerical constants used consistently throughout the project.

## Key Findings / Results

This modeling effort has yielded several key insights into molecular cloud properties and star formation:

* Our models successfully reproduce observed HCN and CO J=1-0 intensities across a wide range of galactic environments, consistent with previous numerical and observational studies.

* The modeled HCN/CO intensity ratio primarily tracks gas at moderate densities (approximately $n \sim 10^{3.5} \text{ cm}^{-3}$), rather than strictly dense gas (e.g., $n > 10^{4.5} \text{ cm}^{-3}$). This suggests that HCN/CO may not be a reliable tracer of the densest, gravitationally bound, star-forming gas fraction.

* Variations in CO emissivity are primarily driven by changes in optical depth due to gas dynamics, contributing significantly to the scatter observed in star formation scaling relations. In contrast, HCN emissivity is more strongly correlated with excitation, indicating different physical origins for their variations.

## Technologies Used

* Python `3.9`

* NumPy

* Matplotlib

* Astropy

* Pandas

* SciPy

* Scikit-learn

* Multiprocessing (Python standard library, optionally enabled for performance)

## How to Run the Project

To set up and run this project locally, follow these steps:

1.  **Clone the Repository:**
    Open your terminal or command prompt and execute:
    ```bash
    git clone [https://github.com/ashleyrbemis/cloud-temperature-emissivity-model.git](https://github.com/ashleyrbemis/cloud-temperature-emissivity-model.git)
    cd cloud-temperature-emissivity-model
    ```

2.  **Create and Activate Conda Environment:**
    It is highly recommended to use a dedicated Conda environment to manage project dependencies.
    ```bash
    conda create -n model_hcn_co_env python=3.9
    conda activate model_hcn_co_env
    ```

3.  **Install Dependencies:**
    All required Python packages are listed in `requirements.txt`. Install them using pip:
    ```bash
    pip install -r requirements.txt
    ```

4.  **Execute the Modeling Pipeline:**
    Run the scripts in the following order from the project's root directory:

    a.  **Run the initial cloud model calculations:**
        ```bash
        python input_measurements_grid.py
        ```
        This script will:
        * Read input cloud properties from `model_subset300.csv`.
        * Estimate gas temperature profiles using a modified code based on Sharda, P., & Krumholz, M. R. 2022.
        * Generate plots of heating/cooling terms and temperature profiles, saving them to `figures/models/`.
        * Save detailed model information to the `output/` directory.
        * Append summarized model results to `model_grid.tsv`.
        * **Note:** The provided code in this repository processes only the first five data points from `model_subset300.csv` for demonstration purposes. The full research paper, Bemis et al., A&A, 692, A146 (2024), uses all 300 data points and generates a more comprehensive set of results.

    b.  **Run the radiative transfer and molecular line calculations:**
        ```bash
        python run_model_grid.py
        ```
        This script will:
        * Read detailed cloud model outputs from the `output/` directory.
        * Perform radiative transfer calculations to derive molecular line properties for CO, HCN, and HCO+.
        * Calculate star formation properties and molecular emissivities.
        * Save derived properties to individual `.tsv` files in the `output/` directory.
        * Generate plots of molecular line fluxes and optical depths, saving them to `figures/models/`.
        * *(Note: Multiprocessing is commented out in this version and runs sequentially.)*

## Project Structure

This project is organized as follows:

* `input_measurements_grid.py`: Reads cloud properties, estimates gas temperature profiles, and saves detailed model outputs and plots.

* `run_model_grid.py`: Processes output from `input_measurements_grid.py` to perform radiative transfer calculations and derive molecular line properties and star formation characteristics.

* `constants.py`: Defines physical and numerical constants used throughout the project.

* `check_temp.py`: Contains functions related to gas temperature calculations and heating/cooling mechanisms.

* `PDF_model_functions.py`: Implements functions for constructing Probability Distribution Functions (PDFs) of molecular cloud properties.

* `emissivity_model_functions.py`: Functions for calculating molecular emissivities and star formation properties.

* `radex_functions.py`: Scripts for interacting with RADEX (Radiative Transfer Code for Molecular Lines).

* `temp_estimate.py`: Contains various temperature estimation functions.

* `model_subset300.csv`: Input data for the cloud models.

* `grid_COcooling_new.out`: Necessary input file for the cooling calculations.

* `requirements.txt`: Lists all Python dependencies.

* `.gitignore`: Specifies files and directories to be ignored by Git.

* `output/`: Directory for generated detailed data files (e.g., radial profiles of gas density, temperature, and heating/cooling terms).

* `figures/models/`: Directory for generated plots (e.g., heating/cooling balance, temperature vs. gas volume density, molecular line fluxes, and optical depths).

## Contact

For any questions, collaborations, or feedback, please contact:

Ashley R. Bemis

* www.linkedin.com/in/ashley-r-bemis

* https://github.com/ashleyrbemis/cloud-temperature-emissivity-model

## License

This project is licensed under the MIT License. See the `LICENSE.md` file for details. This open-source license allows for broad reuse, modification, and distribution, encouraging community contributions and academic collaboration.

---

**Citing This Work:**

If you use this code or its derivatives in your own research or projects, please cite the associated publication:

Bemis et al., A&A, 692, A146 (2024)
